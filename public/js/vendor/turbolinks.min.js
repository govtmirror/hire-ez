var anchoredLink,assets,assetsChanged,browserCompatibleDocumentParser,browserSupportsPushState,cacheCurrentPage,changePage,constrainPageCacheTo,createDocument,crossOriginLink,currentState,executeScriptTags,extractAssets,extractLink,extractTitleAndBody,fetchHistory,fetchReplacement,handleClick,ignoreClick,initialized,installClickHandlerLast,intersection,noTurbolink,nonHtmlLink,nonStandardClick,pageCache,recallScrollPosition,referer,reflectNewUrl,reflectRedirectedUrl,rememberCurrentAssets,rememberCurrentState,rememberCurrentUrl,rememberInitialPage,resetScrollPosition,targetLink,triggerEvent,visit,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};initialized=!1,currentState=null,referer=document.location.href,assets=[],pageCache={},createDocument=null,visit=function(e){return browserSupportsPushState?(cacheCurrentPage(),reflectNewUrl(e),fetchReplacement(e)):document.location.href=e},fetchReplacement=function(e){var t,n=this;return triggerEvent("page:fetch"),t=new XMLHttpRequest,t.open("GET",e,!0),t.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),t.setRequestHeader("X-XHR-Referer",referer),t.onload=function(){var e;return e=createDocument(t.responseText),assetsChanged(e)?document.location.reload():(changePage.apply(null,extractTitleAndBody(e)),reflectRedirectedUrl(t),resetScrollPosition(),triggerEvent("page:load"))},t.onabort=function(){return console.log("Aborted turbolink fetch!")},t.send()},fetchHistory=function(e){var t;return cacheCurrentPage(),(t=pageCache[e.position])?(changePage(t.title,t.body),recallScrollPosition(t),triggerEvent("page:restore")):fetchReplacement(document.location.href)},cacheCurrentPage=function(){return rememberInitialPage(),pageCache[currentState.position]={url:document.location.href,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset},constrainPageCacheTo(10)},constrainPageCacheTo=function(e){var t,n,r;r=[];for(t in pageCache){if(!__hasProp.call(pageCache,t))continue;n=pageCache[t],t<=currentState.position-e?r.push(pageCache[t]=null):r.push(void 0)}return r},changePage=function(e,t,n){return document.title=e,document.documentElement.replaceChild(t,document.body),n&&executeScriptTags(),currentState=window.history.state,triggerEvent("page:change")},executeScriptTags=function(){var e,t,n,r,i,s,o,u,a,f,l,c;a=document.body.getElementsByTagName("script"),c=[];for(i=0,o=a.length;i<o;i++){r=a[i];if(r&&((f=r.type)===""||f==="text/javascript"))if(r.src!=null&&r.src!==""&&r.getAttribute("data-turbolinks-evaluated")==null){t=document.createElement("script"),l=r.attributes;for(s=0,u=l.length;s<u;s++)e=l[s],t.setAttribute(e.name,e.value);t.setAttribute("data-turbolinks-evaluated",""),n=r.parentNode,n.removeChild(r),c.push(n.insertBefore(t,n.childNodes[0]))}else c.push(window.eval(r.innerHTML))}return c},reflectNewUrl=function(e){if(e!==document.location.href)return referer=document.location.href,window.history.pushState({turbolinks:!0,position:currentState.position+1},"",e)},reflectRedirectedUrl=function(e){var t;if(t=e.getResponseHeader("X-XHR-Current-Location"))return window.history.replaceState(currentState,"",t)},rememberCurrentUrl=function(){return window.history.replaceState({turbolinks:!0,position:Date.now()},"",document.location.href)},rememberCurrentState=function(){return currentState=window.history.state},rememberCurrentAssets=function(){return assets=extractAssets(document)},rememberInitialPage=function(){if(!initialized)return rememberCurrentUrl(),rememberCurrentState(),createDocument=browserCompatibleDocumentParser(),initialized=!0},recallScrollPosition=function(e){return window.scrollTo(e.positionX,e.positionY)},resetScrollPosition=function(){return window.scrollTo(0,0)},triggerEvent=function(e){var t;return t=document.createEvent("Events"),t.initEvent(e,!0,!0),document.dispatchEvent(t)},extractAssets=function(e){var t,n,r,i,s;i=e.head.childNodes,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],(t.src||t.href)&&s.push(t.src||t.href);return s},assetsChanged=function(e){var t;return t=extractAssets(e),t.length!==assets.length||intersection(t,assets).length!==assets.length},intersection=function(e,t){var n,r,i,s,o;e.length>t.length&&(s=[t,e],e=s[0],t=s[1]),o=[];for(r=0,i=e.length;r<i;r++)n=e[r],__indexOf.call(t,n)>=0&&o.push(n);return o},extractTitleAndBody=function(e){var t;return t=e.querySelector("title"),[t!=null?t.textContent:void 0,e.body,"runScripts"]},browserCompatibleDocumentParser=function(){var e,t,n,r;return e=function(e){return(new DOMParser).parseFromString(e,"text/html")},t=function(e){var t;return t=document.implementation.createHTMLDocument(""),t.open("replace"),t.write(e),t.close(),t},window.DOMParser&&(n=e("<html><body><p>test")),(n!=null?(r=n.body)!=null?r.childNodes.length:void 0:void 0)===1?e:t},installClickHandlerLast=function(e){if(!e.defaultPrevented)return document.removeEventListener("click",handleClick),document.addEventListener("click",handleClick)},handleClick=function(e){var t;if(!e.defaultPrevented){t=extractLink(e);if((t!=null?t.nodeName:void 0)==="A"&&!ignoreClick(e,t))return visit(t.href),e.preventDefault()}},extractLink=function(e){var t;t=e.target;while(!!t.parentNode&&t.nodeName!=="A")t=t.parentNode;return t},crossOriginLink=function(e){return location.protocol!==e.protocol||location.host!==e.host},anchoredLink=function(e){return(e.hash&&e.href.replace(e.hash,""))===location.href.replace(location.hash,"")||e.href===location.href+"#"},nonHtmlLink=function(e){return e.href.match(/\.[a-z]+(\?.*)?$/g)&&!e.href.match(/\.html?(\?.*)?$/g)},noTurbolink=function(e){var t;while(!t&&e!==document)t=e.getAttribute("data-no-turbolink")!=null,e=e.parentNode;return t},targetLink=function(e){return e.target.length!==0},nonStandardClick=function(e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey},ignoreClick=function(e,t){return crossOriginLink(t)||anchoredLink(t)||nonHtmlLink(t)||noTurbolink(t)||targetLink(t)||nonStandardClick(e)},browserSupportsPushState=window.history&&window.history.pushState&&window.history.replaceState&&window.history.state!==void 0,browserSupportsPushState&&(rememberCurrentAssets(),document.addEventListener("click",installClickHandlerLast,!0),window.addEventListener("popstate",function(e){var t;if((t=e.state)!=null?t.turbolinks:void 0)return fetchHistory(e.state)})),this.Turbolinks={visit:visit};